import os,re
import numpy as np
import random
import math
import matplotlib
import matplotlib.pyplot as plt
matplotlib.rcParams["toolbar"] = "None"             # éšè—å·¥å…·æ  
matplotlib.rcParams['font.sans-serif'] = ['SimHei'] # ä¸­æ–‡æ˜¾ç¤º
matplotlib.rcParams['axes.unicode_minus'] = False   # è´Ÿå·æ˜¾ç¤º
matplotlib.rcParams['lines.linewidth'] = 0.9        # çº¿æ¡å®½åº¦
linewidth_bak = matplotlib.rcParams['lines.linewidth']

# å®šä¹‰next_numå‡½æ•°
def get_next_num(mySetting,current_num,current_action):
    next_num = current_num+mySetting.actions[current_action]*mySetting.unit
    return next_num

def get_valid_actions(mySetting,current_num):
    # å–å½“å‰çŠ¶æ€ä¸‹çš„åˆæ³•åŠ¨ä½œé›†åˆ
    valid_actions = [a for a in mySetting.actions if 
                     (a*mySetting.unit+current_num) <= mySetting.max_storages]
    return valid_actions

class Settings:
    def __init__(self):
        self.epsilon = 0.1 # è´ªå©ªåº¦ greedy
        self.alpha = 0.5   # å­¦ä¹ ç‡
        self.gamma = 0.9   # å¥–åŠ±é€’å‡å€¼
        self.beta = 0.9    
        # å­¦ä¹ ç‡åˆå§‹åŒ–ä¸º0.7ï¼Œå½“è®­ç»ƒ2ä¸‡æ¬¡ï¼Œæ¯è¿­ä»£åƒæ¬¡ä¾¿å°†å­¦ä¹ ç‡é™ä½ä¸ºğ›¼âˆ—ğ›½ï¼Œğ›½=0.9
    
        self.trainGate = 20000 # è®­ç»ƒé—¨æ§›ï¼Œå³éœ€è¦ç»è¿‡å¤šå°‘æ­¥è®­ç»ƒåæ‰èƒ½è¾¾åˆ°ä¸€å®šçš„æ€§èƒ½æ°´å¹³æˆ–å®Œæˆè®­ç»ƒ
        self.StepMinus = 1000  # æ¯æ¬¡è®­ç»ƒæ—¶æ­¥é•¿çš„å‡å°‘é‡

        self.onwaydays = 1 # æå‰æœŸä¸º1å¤©ï¼Œä»ä¸‹å•åˆ°æ”¶åˆ°è´§çš„æ—¶é—´
        self.liftime = 3   # ç”Ÿå‘½å‘¨æœŸä¸º3å¤©
        self.overduecost = 1.7 # è¿‡æœŸæˆæœ¬ä¸º1.7å…ƒï¼Œ
        self.shortagecost = 0.4 # ç¼ºè´§æˆæœ¬ä¸º0.4å…ƒ
        self.holdcost = 0.1 # æŒæœ‰æˆæœ¬ä¸º0.1å…ƒ
        self.profit = 0.6 # å•ä½åˆ©æ¶¦=å”®ä»·2.1-è®¢è´­æˆæœ¬1.5

        self.max_storages = 100
        self.init_min_val = 0
        self.order_point = 14
        self.order_volume = 43
        self.expect = 60
        self.variance = 5
        self.train_data_n = 1000
        self.unit = 5

        # å®šä¹‰Qè¡¨
        self.actions = list(range(21)) # actionåŒ…å«ä»0åˆ°20çš„21ä¸ªæ•°å­—
        a = self.max_storages+1 # aè¡¨ç¤ºçŠ¶æ€æ•°ï¼ˆå³æœ€å¤§å­˜å‚¨æ•°+1ï¼‰
        b = len(self.actions)  # bè¡¨ç¤ºåŠ¨ä½œæ•°ï¼ˆå³0-20ï¼‰
        self.Q_table = np.zeros((a,b)) # åˆ›å»ºä¸€ä¸ªaè¡Œbåˆ—çš„å…¨é›¶çŸ©é˜µä½œä¸ºQ-tableçš„åˆå§‹å€¼
        self.Q_table[:,:] = self.init_min_val
        
def getEpsilon(self):
    return self.epsilon

def getAlpha(self,num):
    return self.alpha

def getGamma(self):
    return self.gamma

def getRewards(self,overdue_num,short_num,sale_num,store_num):
    all_cost = self.max_storages*self.overduecost
    now_cost = self.overduecost*overdue_num + self.shortagecost*short_num + self.holdcost*store_num
    rewards = all_cost-now_cost
    return rewards

def get_loss_rate(self,overdue_num,short_num):
    all_cost = self.max_storages*self.overduecost
    now_cost = self.overduecost*overdue_num + self.shortagecost*short_num
    loss_rate = now_cost/all_cost
    return loss_rate
    
def get_store_cost(self,overdue_num,short_num,current_num):
    now_cost = self.overduecost * overdue_num + self.shortagecost * short_num
    now_cost += current_num*self.holdcost # å°†å½“å‰åº“å­˜æˆæœ¬åŠ ä¸Šå½“å‰åº“å­˜é‡çš„æŒæœ‰åº“å­˜
    return now_cost*1000  # å°†æˆæœ¬è½¬æ¢ä¸ºåƒå…ƒ

class Product:
    def __init__(self,lifetime,onwaydays):  # åˆå§‹åŒ–
        self.lifetime = lifetime
        self.onwaydays = onwaydays
    
    def updateLifeTime(self,days): 
        self.lifetime -= days
        self.onwaydays -= days  # lifetimeå’Œ onwaydaysåˆ†åˆ«å‡å»ä¼ å…¥çš„days

    def isOnTheWay(self):  # åˆ¤æ–­æ˜¯å¦åœ¨è¿è¾“é€”ä¸­
        if self.onwaydays > 0:
            return True
        else:
            return False
    
    def isInStoreHouse(self): # åˆ¤æ–­æ˜¯å¦åœ¨åº“å­˜ä¸­
        if self.lifetime > 0 and self.onwaydays <= 0:
            return True
        else:
            return False

    def isOverDue(self):   # åˆ¤æ–­æ˜¯å¦å·²ç»è¿‡æœŸ
        if self.lifetime <= 0:
            return True
        else:
            return False
        
    # ç»Ÿè®¡å•†å“åˆ—è¡¨ä¸­ isInStoreHouse()æ–¹æ³•è¿”å›å€¼ä¸ºTrueçš„å•†å“æ•°é‡
    def getInStoreHouseNum(ProductList):
        num1 = len(ProductList)
        num2 = 0
        for i in range(num1):
            if ProductList[i].isInStoreHouse():
                num2 = num2 + 1
        return num2
    
    def getOnTheWayNum(ProductList):
        num1 = len(ProductList)
        num2 = 0
        for i in range(num1):
            if ProductList[i].isOnTheWay():
                num2 = num2 + 1
        return num2

    def getOverDueNum(ProductList):
        num1 = len(ProductList)
        num2 = 0
        for i in range(num1):
            if ProductList[i].isOverDue():
                num2 = num2 + 1
        return num2
    
# ä»åŸå§‹çš„ProductListåˆ—è¡¨ä¸­åˆ é™¤è¿‡æœŸäº§å“
def deleteOverDueProduct(ProductList):
    tmplist = ProductList[:]
    for product in tmplist:
        if product.isOverDue():
            ProductList.remove(product)

def AddProductOrder(ProductList,lifetime,onwaydays,num):
    for i in range(num):
        product = Product(lifetime,onwaydays)
        ProductList.append(product)

def updateProductLife(ProductList):
    num1 = len(ProductList)
    num2 = 0
    for i in range(num1):
        ProductList[i].updateLifeTime(1)
# å¯¹ProductListåˆ—è¡¨ä¸­çš„æ¯ä¸ªäº§å“è°ƒç”¨updateLifeTime(1)æ–¹æ³•ï¼Œä½¿äº§å“çš„å¯¿å‘½å¢åŠ 1å¤©

# å»é™¤æ‰ProductListä¸­å‰é¢numä¸ªå¯¿å‘½è¾ƒä½çš„å•†å“
def CheckOutProduct(ProductList,num):
# æŒ‰ç…§æ¯ä¸ªå…ƒç´ çš„lifetimeå±æ€§å‡åºæ’åºProductListåˆ—è¡¨ï¼Œlifetimeå±æ€§è¾ƒé•¿çš„äº§å“ä¼šè¢«æ’åˆ°åˆ—è¡¨å‰é¢
    ProductList.sort(key=lambda x:x.lifetime)
# ä»ProductListä¸­ä¿ç•™å‰numä¸ªäº§å“ä¹‹åçš„å‰©ä½™éƒ¨åˆ†  
    ProductList = ProductList[num:]
    return ProductList

def Train_func(qfile,train_data,max_circle=10000):
    mySetting = Settings() 
    maxDays = max_circle
# åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ProductListï¼Œç”¨äºå­˜å‚¨äº§å“å¯¹è±¡
    ProductList = []

# åœ¨ç»™å®šçš„æœ€å¤§å¤©æ•°maxDaysèŒƒå›´å†…åå¤éå†è®­ç»ƒæ•°æ®é›†ä¸­çš„æ¯ä¸€å¤©
    step = len(train_data)
    preAction = 0
    preNum = 0
    for i in range(maxDays):
# æœºå™¨å­¦ä¹ ï¼Œè¡¥è´§
        j = i%step # å°†å˜é‡ié™¤ä»¥stepçš„ä½™æ•°èµ‹å€¼ç»™å˜é‡j,å°†ié™å®šåœ¨0åˆ°step-1ä¹‹é—´ï¼Œå¾ªç¯éå†train_data
        buy_num = int(train_data[j]) 
        # intå°†å­—ç¬¦ä¸²å‹æ•°æ®è½¬æ¢ä¸ºæ•´æ•°å‹æ•°æ®
        # ä»è®­ç»ƒæ•°æ®é›†ä¸­è·å–ç¬¬jå¤©çš„è´­ä¹°æ•°buy_num

# æ¸…ç†è¿‡æœŸè´§ç‰©
    overdue_n = getOverDueNum(ProductList)
    deleteOverDueProduct(ProductList)

# å½“å‰çŠ¶æ€
    current_num = getInStoreHouseNum(ProductList)
    if buy_num > current_num:
            short_n = buy_num - current_num
    else:
        short_n = 0
        
# å½“å¤©å–å‡ºçš„è´§ç‰©å‡ºåº“ï¼Œå³å°†å‰buy_num - short_nä¸ªäº§å“ä»åˆ—è¡¨ä¸­åˆ é™¤
        ProductList = CheckOutProduct(ProductList, buy_num - short_n)
# é‡æ–°è·å–å½“å‰çŠ¶æ€ï¼Œå‡†å¤‡è¡¥è´§
        current_num = getInStoreHouseNum(ProductList)

# æ ¹æ®è´å°”æ›¼æ–¹ç¨‹ï¼Œæ›´æ–° Q table ä¸­å½“å‰çŠ¶æ€-åŠ¨ä½œå¯¹åº”çš„ Q value
    alpha = mySetting.getAlpha(i)
    gamma = mySetting.getGamma()
    rewards = mySetting.getRewards(overdue_n,short_n,buy_num - short_n,preNum)
    pre_q_v = mySetting.Q_table[preNum, preAction]
    mySetting.Q_table[preNum, preAction] += alpha * (rewards + gamma * max(mySetting.Q_table[current_num]) - pre_q_v)

# éšæœºæˆ–è´ªå©ªåœ°é€‰æ‹©å½“å‰åŠ¨ä½œ
    if (np.random.uniform() < mySetting.getEpsilon()) or ((mySetting.Q_table[current_num, :] == mySetting.init_min_val).all()): 
        tmp_a = get_valid_actions(mySetting, current_num)  
        s = random.randint(0,len(tmp_a)-1)
        current_action = mySetting.actions.index(tmp_a[s]) # æ¢ç´¢
    else:
        valid_actions = [a for a in mySetting.actions if (a * mySetting.unit + current_num) <= mySetting.max_storages]
        current_action = mySetting.Q_table[current_num, :len(valid_actions)].argmax() # åˆ©ç”¨
    
    preNum = current_num
    preAction = current_action

# è¡¥å……è´§ç‰©
    add_num = mySetting.actions[current_action] * mySetting.unit
    AddProductOrder(ProductList,mySetting.liftime,mySetting.onwaydays,add_num)

# åˆ·æ–°è´§ç‰©ç”Ÿå­˜æ—¶é—´
    updateProductLife(ProductList)

    fh = open(qfile,"w")
    aa = mySetting.Q_table.shape
    # éå†Q_tableæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å½¢å¼
    for i in range(aa[0]):
        tmp1 = mySetting.Q_table[i].tolist()
    # æŒ‰ç…§é€—å·è¿›è¡Œè¿æ¥ï¼Œå¹¶åœ¨å…¶æœ«å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦
        tmp2 = [str(a) for a in tmp1]
        cntStr = ",".join(tmp2)+"\n"
        fh.write(cntStr)
        fh.close()
        
    def Exe_func1(qfile,outfile,logfile,test_data,init_num):
        mySetting = Settings()
        ProductList = []
        mySetting.Q_table = Read_Q_Data(qfile)
    
    AddProductOrder(ProductList, mySetting.liftime,mySetting.onwaydays, init_num)
    updateProductLife(ProductList)
    updateProductLife(ProductList)
    updateProductLife(ProductList)
    
    lgf = open(logfile,"w")
    # å‘æ–‡ä»¶ä¸­å†™å…¥ç¬¬ä¸€è¡Œæ ‡é¢˜ï¼ŒåŒ…æ‹¬éœ€æ±‚æ—¥æœŸã€éœ€æ±‚é‡ç­‰ä¿¡æ¯
    lgf.write("æ—¥æœŸ,éœ€æ±‚,å­˜é‡,è¿‡æœŸé‡,ç¼ºè´§,è®¢è´§åŠ¨ä½œ,åº“å­˜å˜åŠ¨\n")
    
    fh = open(outfile,"w")
    step = len(test_data)
    for i in range(step):
        buy_num = int(test_data[i]) # ä»æµ‹è¯•é›†ä¸­è·å–ç¬¬iå¤©çš„è´­ä¹°æ•°buy_num
        
# æ¸…ç†è¿‡æœŸè´§ç‰©
    overdue_n = getOverDueNum(ProductList)
    deleteOverDueProduct(ProductList)

# å½“å‰çŠ¶æ€
    current_num = getInStoreHouseNum(ProductList)
    storage_num = current_num
    if buy_num > current_num:
            short_n = buy_num - current_num
    else:
        short_n = 0
        
# å½“å¤©å–å‡ºçš„è´§ç‰©å‡ºåº“ï¼Œå³å°†å‰buy_num - short_nä¸ªäº§å“ä»åˆ—è¡¨ä¸­åˆ é™¤
        ProductList = CheckOutProduct(ProductList, buy_num - short_n)
# é‡æ–°è·å–å½“å‰çŠ¶æ€ï¼Œå‡†å¤‡è¡¥è´§
        current_num = getInStoreHouseNum(ProductList)
    
    valid_actions = [a for a in mySetting.actions if (a * mySetting.unit + current_num) <= mySetting.max_storages]
    current_action = mySetting.Q_table[current_num, :len(valid_actions)].argmax() # åˆ©ç”¨
# è¡¥å……è´§ç‰©
    add_num = mySetting.actions[current_action] * mySetting.unit
    AddProductOrder(ProductList,mySetting.liftime,mySetting.onwaydays,add_num)

# åˆ·æ–°è´§ç‰©ç”Ÿå­˜æ—¶é—´
    updateProductLife(ProductList)
    
    store_cost = mySetting.get_store_cost(overdue_n,short_n,current_num+add_num)
    cntStr = "{0},{1:.2f}\n".format(i, store_cost)
    fh.write(cntStr)
    
    loginfo =[str(i),str(buy_num),str(storage_num),str(overdue_n),str(short_n),str(add_num),str(current_num+add_num-storage_num)]
    cntStr = ",".join(loginfo) + "\n"
    lgf.write(cntStr)
    
    fh.close()
    lgf.close()
    
    def Exe_func2(qfile,outfile,logfile,test_data,init_num):
        mySetting = Settings()
        ProductList = []
        mySetting.Q_table = Read_Q_Data(qfile)
    
    AddProductOrder(ProductList, mySetting.liftime,mySetting.onwaydays, init_num)
    updateProductLife(ProductList)
    updateProductLife(ProductList)
    updateProductLife(ProductList)
    
    lgf = open(logfile,"w")
    # å‘æ–‡ä»¶ä¸­å†™å…¥ç¬¬ä¸€è¡Œæ ‡é¢˜ï¼ŒåŒ…æ‹¬éœ€æ±‚æ—¥æœŸã€éœ€æ±‚é‡ç­‰ä¿¡æ¯
    lgf.write("æ—¥æœŸ,éœ€æ±‚,å­˜é‡,è¿‡æœŸé‡,ç¼ºè´§,è®¢è´§åŠ¨ä½œ,åº“å­˜å˜åŠ¨\n")
    
    fh = open(outfile,"w")
    step = len(test_data)
    for i in range(step):
        buy_num = int(test_data[i]) # ä»æµ‹è¯•é›†ä¸­è·å–ç¬¬iå¤©çš„è´­ä¹°æ•°buy_num
        
# æ¸…ç†è¿‡æœŸè´§ç‰©
    overdue_n = getOverDueNum(ProductList)
    deleteOverDueProduct(ProductList)

# å½“å‰çŠ¶æ€
    current_num = getInStoreHouseNum(ProductList)
    storage_num = current_num
    if buy_num > current_num:
            short_n = buy_num - current_num
    else:
        short_n = 0
        
# å½“å¤©å–å‡ºçš„è´§ç‰©å‡ºåº“ï¼Œå³å°†å‰buy_num - short_nä¸ªäº§å“ä»åˆ—è¡¨ä¸­åˆ é™¤
        ProductList = CheckOutProduct(ProductList, buy_num - short_n)
# é‡æ–°è·å–å½“å‰çŠ¶æ€ï¼Œå‡†å¤‡è¡¥è´§
        current_num = getInStoreHouseNum(ProductList)
    
    add_num = 0
    if current_num<mySetting.order_point:
        add_num = mySetting.order_volume
        
    AddProductOrder(ProductList, mySetting.liftime, mySetting.onwaydays, add_num)
    updateProductLife(ProductList)
    
    store_cost = mySetting.get_store_cost(overdue_n, short_n,current_num+add_num)
    cntStr = "{0},{1:.2f}\n".format(i, store_cost)
    fh.write(cntStr)
    
    loginfo = [str(i),str(buy_num),str(storage_num),str(overdue_n),str(short_n),str(add_num),str(current_num+add_num-storage_num)]
    cntStr = ",".join(loginfo) + "\n"
    lgf.write(cntStr)
    
    fh.close()
    lgf.close()
    
    # è¯»å–æ–‡ä»¶æ‰€æœ‰çš„è¡Œ
    def ReadTxtName(filename, dot=',', encoding="gbk"):
        lines = []
        if os.path.exists(filename): # åˆ¤æ–­filenameæ–‡ä»¶æ˜¯å¦å­˜åœ¨
            pass
        else:
            return []
        
    with open(filename, 'r', encoding=encoding) as file_to_read:
        tmpall = file_to_read.readlines()
        for line in tmpall:
            tmpstr = line.strip('\n').strip() # å»æ‰æ¯è¡Œå­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰
            if tmpstr.startswith('#'): # åˆ¤æ–­tmpstrå­—ç¬¦ä¸²æ˜¯å¦ä»¥#å¼€å¤´
                continue # å¦‚æœæ˜¯æ³¨é‡Šè¡Œï¼Œåˆ™ç»§ç»­è·³è¿‡åé¢çš„ä»£ç ï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯
                
                if len(tmpstr) >0:
                    line = tmpstr.split(dot) # å°†tmpstrå­—ç¬¦ä¸²æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦dotè¿›è¡Œåˆ†å‰²
                    lines.append(line)
    return lines
    
    # listä¸ºäºŒç»´åˆ—è¡¨ï¼Œrowä¸ºè¡Œï¼Œcolä¸ºåˆ—
    def GetColumnFromList(list, startrow=0, endrow=None, col=0):
        data = []
        if endrow is None or endrow > len(list):
            endrow = len(list)
        
        for i in range(startrow, endrow): # éå†åˆ—è¡¨çš„è¡Œæ•°
            data.append(list[i][col]) # å°†æ¯è¡Œçš„ç¬¬â€œcolâ€åˆ—çš„æ•°æ®æ·»åŠ åˆ°â€œdataâ€åˆ—è¡¨
            
        return data
    
    # åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºæ•°å€¼ç±»å‹ï¼Œå¦‚æœæ˜¯å°±è¿”å› Trueï¼Œå¦åˆ™ä¸è¿”å›ç»“æœ
    def is_number(num):
        if isinstance(num, str):
            pass
        else:
            return True

    # æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…æ•°å€¼ç±»å‹çš„å­—ç¬¦ä¸²å½¢å¼
    pattern = re.compile(r'^[-+]?[-0-9]\d*\.\d*|[-+]?\.?[0-9]\d*$')
    result = pattern.match(num)
    
    if result:
        return True
    else:
        return False
    
    # å°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬åŒ–ä¸ºæµ®ç‚¹æ•°åˆ—è¡¨
    def StrListToFloat(list):
        data = []
        for x in list:
            if x != '': # å½“å‰å…ƒç´ ä¸ä¸ºç©ºå­—ç¬¦ä¸²
                data.append(float(x)) # è½¬åŒ–ä¸ºæµ®ç‚¹æ•°ç±»å‹
            else:
                data.append(0)
        return data

    # å°†äºŒç»´å­—ç¬¦ä¸²åˆ—è¡¨è½¬åŒ–ä¸ºæµ®ç‚¹æ•°åˆ—è¡¨
    def StrList2ToFloat(list):
        rslt = []
        for row in list:
            data = []
            for x in row:
                if x != '':
                    if is_number(x):
                        data.append(float(x))
                    else:
                        data.append(x)
                # å¦‚æœå½“å‰å…ƒç´ ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶å¡«è¡¥ä¸ºé»˜è®¤å€¼ 0ï¼Œå¹¶æ·»åŠ åˆ° â€œdataâ€ åˆ—è¡¨ä¸­
                else:
                    data.append(0) 
            rslt.append(data)
        return rslt

    # ç»˜åˆ¶å‡ºæŠ˜çº¿å›¾
    def DrawLine(logfile1,logfile2):
        fig = plt.figure(figsize=(10, 5), dpi=80)
        mng = plt.get_current_fig_manager()
        left, width = 0.05, 0.90
        # ä¸»è½´ï¼ˆax1ï¼‰çš„ä½ç½®å’Œå¤§å°ï¼ŒèƒŒæ™¯é¢œè‰²
        ax1 = fig.add_axes([left, 0.05, width, 0.90], gid='mygroup') 
        ax1.set_facecolor("White")
        
        # è·å–logfile1ä¸­çš„ç¬¬1åˆ—ï¼Œå¹¶å–ç»å¯¹å€¼
        lines1 = ReadTxtName(logfile1, ",")
        day_col1 = GetColumnFromList(lines1, col=0)
        day_col1 = day_col1[:]
        day_col1 = StrListToFloat(day_col1)
        day_col1 = [abs(aa) for aa in day_col1]
        
        # è·å–logfile1ä¸­çš„ç¬¬2åˆ—ï¼Œå¹¶å–ç»å¯¹å€¼
        loss_col1 = GetColumnFromList(lines1, col=1)
        loss_col1 = loss_col1[:]
        loss_col1 = StrListToFloat(loss_col1)
        loss_col1 = [abs(aa) for aa in loss_col1]
        
        ax1.plot(day_col1, loss_col1, color = 'green', linestyle='-')
        
        # è·å–logfile2ä¸­çš„ç¬¬1åˆ—ï¼Œå¹¶å–ç»å¯¹å€¼
        lines2 = ReadTxtName(logfile2, ",")
        day_col2 = GetColumnFromList(lines2, col=0)
        day_col2 = day_col2[:]
        day_col2 = StrListToFloat(day_col2)
        day_col2 = [abs(aa) for aa in day_col2]
        
        # è·å–logfile2ä¸­çš„ç¬¬2åˆ—ï¼Œå¹¶å–ç»å¯¹å€¼
        loss_col2 = GetColumnFromList(lines2, col=1)
        loss_col2 = loss_col2[:]
        loss_col2 = StrListToFloat(loss_col2)
        loss_col2 = [abs(aa) for aa in loss_col2]
        
        ax1.plot(day_col2, loss_col2, color = 'r', linestyle='-')
        
        ylabels = [0,10000,20000,30000,40000,50000,60000,70000,80000] # è®¾ç½®yè½´åˆ»åº¦æ ‡ç­¾
        ax1.set_yticklabels(labels=ylabels,family= 'SimHei',fontsize= 12)
        ax1.tick_params(which='major',axis='both',length=8,labelsize=12)
        ax1.legend(labels=('Q-Learning æˆæœ¬', "å›ºå®šè®¢è´§æˆæœ¬"), loc='upper right',fontsize=14)
        plt.show()
        matplotlib.rcParams['lines.linewidth'] = linewidth_bak # æ¢å¤matplotlibé»˜è®¤è®¾ç½®
        
    # ç”Ÿæˆè®­ç»ƒæ•°æ®å¹¶ä¿å­˜åˆ°æ–‡ä»¶
    def Create_Train_Data(datafile):
        mysetting = Settings()
        mu = mysetting.expect
        sigma = mysetting.variance
        num = mysetting.train_data_n
        np.random.seed(1234)
        Train_Data = np.random.normal(mu, sigma, num)
        # ç”Ÿæˆç¬¦åˆæ­£æ€åˆ†å¸ƒçš„éšæœºæ•°ï¼ˆÎ¼ä¸ºæœŸæœ›ï¼ŒÏƒä¸ºæ–¹å·®ï¼Œæ•°é‡ä¸ºnumï¼‰
        
        f1 = open(datafile,"w")
        for i in range(len(Train_Data)):
            cnt = int(Train_Data[i]+0.5)
            
            if i<len(Train_Data)-1:
                f1.write(str(cnt)+",")
            else:
                f1.write(str(cnt))
        f1.close()
    
    # è¯»å–è®­ç»ƒæ•°æ®å¹¶è¿”å›å…¶ä¸­çš„ä¸€è¡Œæ•°æ®
    def Read_Train_Data(datafile):
        data = ReadTxtName(datafile)
        return data[0]
    
    # è¯»å–Qå€¼æ–‡ä»¶å¹¶è¿”å›äºŒç»´åˆ—è¡¨
    def Read_Q_Data(datafile):
        data = ReadTxtName(datafile)
        data1 = StrList2ToFloat(data)
        rslt = np.array(data1)
        return rslt
    
    if __name__ == "__main__":
        datafile = "Train_Data35.csv"
        Create_Train_Data(datafile)

        train_data = Read_Train_Data(datafile)

        qfile = "qfile35.csv"
        Train_func(qfile,train_data,200000)

        rsltfile1 = "rslt35.csv"
        logfile1 = "logfile35.csv"
        
        Exe_func1(qfile,rsltfile1,logfile1,train_data,100)
        
        rsltfile2 = "rslt35_1.csv"
        logfile2 = "logfile35_1.csv"
        Exe_func2(qfile,rsltfile2,logfile2,train_data,100)
        DrawLine(rsltfile1,rsltfile2)
ä¸ºä»€ä¹ˆæ²¡æœ‰æ˜¾ç¤ºå‡ºå›¾å’Œæ•°æ®ï¼Œéº»çƒ¦é‡æ–°æ’ç‰ˆï¼Œä½¿ä¹‹èƒ½æ­£ç¡®æ˜¾ç¤ºï¼Œæ³¨æ„å•åŒå¼•å·ç”¨è‹±æ–‡æ ¼å¼ï¼Œéº»çƒ¦ä¸è¦æ–­å¼€äº†ï¼Œå®Œæ•´ç¼–ç 